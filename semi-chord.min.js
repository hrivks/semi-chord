/*! semi-chord - v1.0.6 | 2022-02-15
 * Hari Vikas Janarthanan | MIT License | https://github.com/hrivks/semi-chord#readme */
var _SC=function(t,e,i,a,n){if(!t)throw"semi-chord: invalid parent element selector. Please specify a element selector string or HTMLElement or SVGElement";return this.parentElement=t,this.data=e,this.config=i,this.dataAttributes=a,this.dataKey=n,this.d3RootNode=d3.select(this.parentElement),!!this.validateData()&&(!!this.validateConfig()&&(this.utils=new this.Utils(this.config.radius,this.config.centerX,this.config.centerY),this.cc=this.computeCoordinates(),this.d3RootNode=this.d3RootNode.append("svg").classed("semi-chord",!0),this.clickManager=this.getClickManager(),this.eventManager=this.getEventManager(),this.highlighting=this.getHighlighting(),this.interactions=this.getInteractions(),void this.draw()))};function semiChord(t){if(!d3)throw"semi-chord: D3.js required. Please visit https://d3js.org/";return new _SC(t.selector,t.data,t.config,t.dataAttributes,t.dataKey).getExport()}_SC.prototype.update=function(){this.validateConfig(),this.cc=this.computeCoordinates(),this.redraw()},_SC.prototype.redraw=function(){this.d3RootNode.selectAll("*").remove(),this.draw(),this.clickManager.reset()},_SC.prototype.validateConfig=function(){var t=this.config,e={width:600,height:400,radius:133,centerX:240,centerY:200,disableInteractions:!1,colorScheme:d3.schemeCategory10,fontFamily:"sans-serif",outlineCircle:{stroke:"#EEE",fill:"none",strokeWidth:"0.25"},ribbon:{opacity:.5,hoverOpacity:.7,hoverInverseOpacity:.1},arc:{innerPadding:.02,outerPadding:.2,rangeStart:0,rangeEnd:.5,width:15,titleTextOffset:15},key:{radius:10,color:"#AAA",fontColor:"#AAA",fontSize:14,rangeStart:.65,rangeEnd:.85},valueLabel:{offsetX:30,backdropOffsetX:12,backdropOffsetXRight:1,fontSize:11,verticalSpace:12,fontOpacity:.8,fontHighlightOpacity:1,fontHighlightInverseColor:"#AAA",fontHighlightSizeIncrement:0,backdropOpacity:.2,backdropHighlightOpacity:.3,disable:!1,autoHide:!1}},i=this.d3RootNode.node();if(!i)return console.log("semi-chord: no valid element found for given parent element selector"),!1;if(t){var a,n;n=i instanceof SVGElement?(a=i.width.baseVal.value,i.height.baseVal.value):(a=i.clientWidth,i.clientHeight),a=a||e.width,n=n||e.height;var o=Math.round(Math.min(a,n)/3);if(t.radius=t.radius||o,t.centerX=t.centerX||a/2.5,t.centerY=t.centerY||n/2,t.disableInteractions=t.disableInteractions||e.disableInteractions,t.colorScheme=t.colorScheme||e.colorScheme,t.fontFamily=t.fontFamily||e.fontFamily,t.outlineCircle){var r=t.outlineCircle,l=e.outlineCircle;r.stroke=r.stroke||l.stroke,r.fill=r.fill||l.fill,r.strokeWidth=r.strokeWidth||l.strokeWidth}else t.outlineCircle=e.outlineCircle;if(t.ribbon){r=t.ribbon,l=e.ribbon;r.opacity=r.opacity||l.opacity,r.hoverOpacity=r.hoverOpacity||l.hoverOpacity,r.hoverInverseOpacity=r.hoverInverseOpacity||l.hoverInverseOpacity}else t.ribbon=e.ribbon;if(t.arc){r=t.arc,l=e.arc;r.innerPadding=r.innerPadding||l.innerPadding,r.outerPadding=r.outerPadding||l.outerPadding,r.rangeStart=r.rangeStart||l.rangeStart,r.rangeEnd=r.rangeEnd||l.rangeEnd,r.width=r.width||l.width,r.titleTextOffset=r.titleTextOffset||l.titleTextOffset}else t.arc=e.arc;if(t.key){r=t.key,l=e.key;r.radius=r.radius||.05*t.radius,r.color=r.color||l.color,r.rangeStart=r.rangeStart||l.rangeStart,r.rangeEnd=r.rangeEnd||l.rangeEnd,r.fontColor=r.fontColor||l.fontColor,r.fontSize=r.fontSize||l.fontSize}else t.key=e.key,t.key.radius=.05*t.radius;if(t.valueLabel){r=t.valueLabel,l=e.valueLabel;r.offsetX=r.offsetX||l.offsetX,r.backdropOffsetX=r.backdropOffsetX||l.backdropOffsetX,r.backdropOffsetXRight=r.backdropOffsetXRight||l.backdropOffsetXRight,r.fontSize=r.fontSize||l.fontSize,r.verticalSpace=r.verticalSpace||l.verticalSpace,r.fontOpacity=r.fontOpacity||l.fontOpacity,r.fontHighlightOpacity=r.fontHighlightOpacity||l.fontHighlightOpacity,r.fontHighlightInverseColor=r.fontHighlightInverseColor||l.fontHighlightInverseColor,r.fontHighlightSizeIncrement=r.fontHighlightSizeIncrement||l.fontHighlightSizeIncrement,r.backdropOpacity=r.backdropOpacity||l.backdropOpacity,r.backdropHighlightOpacity=r.backdropHighlightOpacity||l.backdropHighlightOpacity,r.disable=r.disable||l.disable,r.autoHide=r.autoHide||l.autoHide}else t.valueLabel=e.valueLabel}else{this.config=e,t=this.config;var c=i.clientWidth||e.width,s=i.clientHeight||e.height;o=Math.round(Math.min(c,s)/3);t.radius=o,t.centerX=c/2.5,t.centerY=s/2,t.key.radius=.05*t.radius}return!0},_SC.prototype.validateData=function(){if(!this.data||!this.data[0])return console.log("semi-chord: Invalid data. Expected: array of JSON objects"),!1;if(0===this.data.length)return console.log("semi-chord: No data to plot"),!1;if(!this.dataAttributes)for(var t in this.dataAttributes=[],this.data[0])this.data[0].hasOwnProperty(t)&&this.dataKey!==t&&this.dataAttributes.push(t);return this.dataKey=this.dataKey||this.dataAttributes.splice(0,1)[0],"string"!=typeof this.dataKey?(console.log("semi-chord: Invalid data key"),!1):this.dataAttributes instanceof Array?0!==this.dataAttributes.length||(console.log("semi-chord: No data-attributes found."),!1):(console.log("semi-chord: Invalid data-attributes. Expected: array of string"),!1)},_SC.prototype.Utils=function(i,a,n){this.getCoordinateOnCirlce=function(t,e){return e=e||i,{x:Math.round(a+e*Math.sin(t)),y:Math.round(n-e*Math.cos(t))}},this.getXCoordinateOnCircle=function(t,e){return e=e||i,Math.round(a+e*Math.sin(t))},this.getYCoordinateOnCircle=function(t,e){return e=e||i,Math.round(n-e*Math.cos(t))},this.getRibbonBetweenPoints=function(t,e,i,a){var n=[];n=n.concat(["M ",t.x,",",t.y]);var o={x:(t.x+e.x)/2,y:t.y-10};return n=(n=n.concat([" Q ",o.x,",",o.y," ",e.x,","+e.y])).concat([" Q ",a.x,",",a.y," ",i.x,","+i.y]),o={x:(t.x+i.x)/2,y:t.y+5},(n=n.concat([" Q ",o.x,",",o.y," ",t.x,",",t.y])).join("")},this.getValueLabelBackdrop=function(t,e,i,a){var n={x:e.x+a,y:e.y-10},o={x:i.x+a,y:i.y+10},r=[];return(r=(r=(r=(r=(r=(r=r.concat(["M ",n.x,",",n.y])).concat([" Q ",(e.x+n.x)/2,",",e.y," ",e.x,",",e.y])).concat([" Q ",(t.x+e.x)/2,",",t.y," ",t.x,",",t.y])).concat([" Q ",(i.x+t.x)/2,",",t.y," ",i.x,",",i.y])).concat([" Q ",(o.x+i.x)/2,",",i.y," ",o.x,",",o.y])).concat([" Q ",o.x+(o.y-n.y)/2,",",(o.y+n.y)/2," ",n.x,",",n.y])).join("")},this.getNumericValue=function(t){if(isFinite(t))return parseFloat(t);var e=t.replace(/[^0-9.]/g,"");return e?parseFloat(e):0}},_SC.prototype.computeCoordinates=function(){var c,s=this,t=2*Math.PI,a=d3.scalePoint().domain(s.data.map(function(t,e){return e})).range([t*s.config.key.rangeStart,t*s.config.key.rangeEnd]),i=d3.scaleBand().domain(s.dataAttributes).range([t*s.config.arc.rangeStart,t*s.config.arc.rangeEnd]).paddingInner(s.config.arc.innerPadding).paddingOuter(s.config.arc.outerPadding),h=d3.scaleOrdinal(s.config.colorScheme),u=i.bandwidth()-s.config.arc.innerPadding,g=s.data.map(function(t,e){var i=s.utils.getCoordinateOnCirlce(a(s.data.length-1-e));return i.text=t[s.dataKey],i}),e=s.dataAttributes.map(function(t){var e=i(t);return{start:e,end:e+u}}),n=(c=[],s.dataAttributes.forEach(function(n,o){var t=s.data.reduce(function(t,e){return t+s.utils.getNumericValue(e[n])},0),r=0===t?0:u/t,l=e[o].start;s.data.forEach(function(t,e){var i=s.utils.getNumericValue(t[n]),a=l+i*r;c.push({source:g[e],start:s.utils.getCoordinateOnCirlce(l),end:s.utils.getCoordinateOnCirlce(a),mid:s.utils.getCoordinateOnCirlce((l+a)/2),color:h(n),text:t[s.dataKey]+" : "+t[n],scData:{key:t[s.dataKey],attribute:s.dataAttributes[o],value:t[n]}}),l=a})}),c);return{colorScale:h,keyPointCoordinates:g,arcAngles:e,ribbonPositions:n}},_SC.prototype.draw=function(){var r=this,l=this.config,i=this.d3RootNode,c=this.cc,a=this.interactions,s=this.utils,n=this.eventManager,o=this.eventManager.getEventNames();i.append("circle").attr("cx",l.centerX).attr("cy",l.centerY).attr("r",l.radius).attr("stroke",l.outlineCircle.stroke).attr("stroke-width",l.outlineCircle.strokeWidth).attr("fill",l.outlineCircle.fill),i.append("g").classed("ribbon-wrap",!0).selectAll("path.ribbon").data(c.ribbonPositions).enter().append("path").classed("ribbon",!0).attr("d",function(t){return r.utils.getRibbonBetweenPoints(t.source,t.start,t.end,t.mid)}).attr("fill",function(t){return t.color}).attr("fill-opacity",l.ribbon.opacity).attr("sc-data-key",function(t){return t.scData.key}).attr("sc-data-attribute",function(t){return t.scData.attribute}).attr("sc-data-value",function(t){return t.scData.value}).on("mouseenter",function(t){a.onRibbonMouseEnter(this,t),n.dispatcher([this],t,"ribbon",o.ribbon.mouseEnter)}).on("mouseleave",function(t){a.onRibbonMouseLeave(this,t),n.dispatcher([this],t,"ribbon",o.ribbon.mouseLeave)}).on("click",function(t){a.onRibbonClick(this,t),n.dispatcher([this],t,"ribbon",o.ribbon.click)});var t=i.selectAll("g.key-group").data([c.keyPointCoordinates]).enter().append("g").classed("key-group",!0).selectAll("g.key-element").data(function(t){return t}).enter().append("g").classed("key-element",!0).selectAll("circle.key").data(function(t,e){return t.scData={key:r.data[e][r.dataKey],value:r.dataAttributes.map(function(t){return{attribute:t,value:r.data[e][t]}})},[t]}).enter();t.append("circle").classed("key",!0).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).attr("r",l.key.radius).attr("fill",l.key.color).on("mouseenter",function(t){a.onKeyMouseEnter(this,t),n.dispatcher([this],t,"key",o.key.mouseEnter,"key.point",o.key.point.mouseEnter)}).on("mouseleave",function(t){a.onKeyMouseLeave(this,t),n.dispatcher([this],t,"key",o.key.mouseLeave,"key.point",o.key.point.mouseLeave)}).on("click",function(t){a.onKeyClick(this,t),n.dispatcher([this],t,"key",o.key.click,"key.point",o.key.point.click)}),t.append("text").text(function(t){return t.text}).style("cursor","pointer").attr("x",function(t){return t.x-.08*l.radius}).attr("y",function(t){return t.y+.025*l.radius}).attr("text-anchor","end").attr("fill",l.key.fontColor).attr("font-size",l.key.fontSize).on("mouseenter",function(t){a.onKeyMouseEnter(this,t),n.dispatcher([this],t,"key",o.key.mouseEnter,"key.text",o.key.text.mouseEnter)}).on("mouseleave",function(t){a.onKeyMouseLeave(this,t),n.dispatcher([this],t,"key",o.key.mouseLeave,"key.text",o.key.text.mouseLeave)}).on("click",function(t){a.onKeyMouseLeave(this,t),n.dispatcher([this],t,"key",o.key.click,"key.text",o.key.text.click)});var e=i.append("g").attr("transform","translate("+l.centerX+", "+l.centerY+")").classed("attr-group",!0);e.selectAll("path.attribute").data(r.dataAttributes.map(function(e){return{scData:{attribute:e,value:r.data.map(function(t){return{key:t[r.dataKey],value:t[e]}})}}})).enter().append("path").classed("attribute",!0).attr("d",function(t,e){var i=c.arcAngles[e];return d3.arc().innerRadius(l.radius-.25*l.arc.width).outerRadius(l.radius+.75*l.arc.width).startAngle(i.start).endAngle(i.end)()}).attr("fill",function(t){return c.colorScale(t.scData.attribute)}).on("mouseenter",function(t){a.onAttributeMouseEnter(this,t),n.dispatcher([this],t,"attribute",o.attribute.mouseEnter,"attribute.arc",o.attribute.arc.mouseEnter)}).on("mouseleave",function(t){a.onAttributeMouseLeave(this,t),n.dispatcher([this],t,"attribute",o.attribute.mouseLeave,"attribute.arc",o.attribute.arc.mouseLeave)}).on("click",function(t){a.onAttributeClick(this,t),n.dispatcher([this],t,"attribute",o.attribute.click,"attribute.arc",o.attribute.arc.click)});var h=e.append("g").classed("attribute-texts",!0).attr("transform","translate(-"+l.centerX+", -"+l.centerY+")"),u=h.selectAll("text.attribute-title").data(r.dataAttributes.map(function(e,t){var i=(c.arcAngles[t].start+c.arcAngles[t].end)/2,a=l.radius+l.arc.width+l.arc.titleTextOffset,n=s.getCoordinateOnCirlce(i,a),o=c.colorScale(e);return{x:n.x,y:n.y,color:o,scData:{attribute:e,value:r.data.map(function(t){return{key:t[r.dataKey],value:t[e]}})}}})).enter().append("text").classed("attribute-title",!0).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("fill",function(t){return t.color}).text(function(t){return t.scData.attribute}).style("cursor","pointer").attr("alignment-baseline","central").attr("font-size",l.key.fontSize).on("mouseenter",function(t){a.onAttributeMouseEnter(this,t),n.dispatcher([this],t,"attribute",o.attribute.mouseEnter,"attribute.text",o.attribute.text.mouseEnter)}).on("mouseleave",function(t){a.onAttributeMouseLeave(this,t),n.dispatcher([this],t,"attribute",o.attribute.mouseLeave,"attribute.text",o.attribute.text.mouseLeave)}).on("click",function(t){a.onAttributeClick(this,t),n.dispatcher([this],t,"attribute",o.attribute.click,"attribute.text",o.attribute.text.click)});if(!l.valueLabel.disable){var g=h.selectAll("g.value-labels").data([r.dataAttributes]).enter().append("g").classed("value-labels",!0).attr("fill-opacity",function(){return l.valueLabel.autoHide||l.valueLabel.disable?0:1}),d=g.selectAll("text.attribute-value-label").data(r.dataAttributes.map(function(e,t){var i=r.data.map(function(t){return t[r.dataKey]+" : "+(t[e]||0)}),a=u.nodes()[t].getBBox(),n=a.x+a.width+l.valueLabel.offsetX,o=a.y+a.height/2;return{attribute:e,color:c.colorScale(e),values:i,x:n,y:o,height:l.valueLabel.verticalSpace}})).enter(),f=[];d.append("text").classed("value-label",!0).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("sc-data-attribute",function(t){return t.attribute}).selectAll("tspan.value-label-element").data(function(i,t){var e=i.values.length*i.height/2,a=d3.scaleLinear().range([-e,e]).domain([0,i.values.length-1]),n=l.valueLabel.offsetX-l.valueLabel.backdropOffsetX;f.push({center:{x:i.x-n,y:i.y},top:{x:i.x+l.valueLabel.backdropOffsetXRight+Math.abs(a(0))/2,y:i.y+a(0)-15},bottom:{x:i.x+l.valueLabel.backdropOffsetXRight+Math.abs(a(i.values.length-1))/2,y:i.y+a(i.values.length-1)+15}});var o=i.color;return i.values.map(function(t,e){return{x:i.x+5+Math.abs(a(e))/2,y:i.y+a(e),text:t,color:o,scData:{key:r.data[e][r.dataKey],attribute:i.attribute,value:r.data[e][i.attribute]}}})}).enter().append("tspan").classed("value-label-element",!0).attr("sc-data-key",function(t){return t.scData.key}).attr("sc-data-attribute",function(t){return t.scData.attribute}).attr("sc-data-value",function(t){return t.scData.value}).text(function(t){return t.text}).style("cursor","pointer").attr("alignment-baseline","central").attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("font-size",l.valueLabel.fontSize).attr("font-weight","normal").attr("fill",function(t){return t.color}).attr("fill-opacity",function(){return l.valueLabel.autoHide||l.valueLabel.disable?0:l.valueLabel.fontOpacity}).on("mouseenter",function(t){if(!l.valueLabel.autoHide&&!l.valueLabel.disable){var e=r.scRibbons.filter('path.ribbon[sc-data-key="'+t.scData.key+'"][sc-data-attribute="'+t.scData.attribute+'"]').node();a.onRibbonMouseEnter(e,t),n.dispatcher([this],t,"label.text",o.label.text.mouseEnter)}}).on("mouseleave",function(t){a.onRibbonMouseLeave(this,t),n.dispatcher([this],t,"label.text",o.label.text.mouseLeave)}).on("click",function(t){if(!l.valueLabel.autoHide&&!l.valueLabel.disable){var e=r.scRibbons.filter('path.ribbon[sc-data-key="'+t.scData.key+'"][sc-data-attribute="'+t.scData.attribute+'"]').node();a.onRibbonClick(e,t),n.dispatcher([this],t,"label.text",o.label.text.click)}}),g.selectAll("path.value-label-backdrop").data(f.map(function(t,e){return t.color=c.colorScale(r.dataAttributes[e]),t.width=i.selectAll("text.value-label").nodes()[e].getBBox().width,t.scData={attribute:r.dataAttributes[e],value:r.data.map(function(t){return{key:t[r.dataKey],value:t[r.dataAttributes[e]]}})},t})).enter().insert("path",":first-child").classed("value-label-backdrop",!0).attr("sc-data-attribute",function(t){return t.scData.attribute}).attr("d",function(t){return s.getValueLabelBackdrop(t.center,t.top,t.bottom,t.width)}).attr("fill-opacity",function(){return l.valueLabel.autoHide||l.valueLabel.disable?0:l.valueLabel.backdropOpacity}).attr("fill",function(t){return t.color}).on("mouseenter",function(t){l.valueLabel.autoHide||l.valueLabel.disable||(a.onAttributeMouseEnter(this,t),n.dispatcher([this],t,"label",o.label.mouseEnter))}).on("mouseleave",function(t){a.onAttributeMouseLeave(this,t),n.dispatcher([this],t,"label",o.label.mouseLeave)}).on("click",function(t){l.valueLabel.autoHide||l.valueLabel.disable||(a.onAttributeClick(this,t),n.dispatcher([this],t,"label",o.label.click))})}var b=i.node().getBBox();i.insert("rect",":first-child").classed("base",!0).attr("x",b.x).attr("y",b.y).attr("width",b.width).attr("height",b.height).attr("fill-opacity",0).on("click",function(){r.clickManager.reset(),r.highlighting.resetHighlights(),n.dispatcher([this],{},"base","onBaseClick")}),i.attr("width","100%").attr("height","100%").attr("font-family",r.config.fontFamily),r.scRibbons=i.selectAll("path.ribbon"),r.scLabels=i.selectAll("tspan.value-label-element"),r.scBackdrops=i.selectAll("path.value-label-backdrop")},_SC.prototype.getEventManager=function(){var i={};function c(e){var t=e&&e.event;if(t&&i[t])try{setTimeout(function(){i[t](e)},0)}catch(t){console.log("Exception in callback for event :"+e.event),console.log(t)}}return{registerCallback:function(t,e){return"string"==typeof t&&"function"==typeof e&&(i[t]=e,!0)},invokeCallback:c,getEventNames:function(){return{onClick:"onClick",onMouseEnter:"onMouseEnter",onMouseLeave:"onMouseLeave",ribbon:{mouseEnter:"onRibbonMouseEnter",mouseLeave:"onRibbonMouseLeave",click:"onRibbonClick",highlight:"onRibbonHighlight",highlightRemoved:"onRibbonHighlightRemoved"},key:{mouseEnter:"onKeyMouseEnter",mouseLeave:"onKeyMouseLeave",click:"onKeyClick",point:{mouseEnter:"onKeyPointMouseEnter",mouseLeave:"onKeyPointMouseLeave",click:"onKeyPointClick"},text:{mouseEnter:"onKeyTextMouseEnter",mouseLeave:"onKeyTextMouseLeave",click:"onKeyTextClick"}},attribute:{mouseEnter:"onAttributeMouseEnter",mouseLeave:"onAttributeMouseLeave",click:"onAttributeClick",arc:{mouseEnter:"onAttributeArcMouseEnter",mouseLeave:"onAttributeArcMouseLeave",click:"onAttributeArcClick"},text:{mouseEnter:"onAttributeTextMouseEnter",mouseLeave:"onAttributeTextMouseLeave",click:"onAttributeTextClick"}},label:{mouseEnter:"onLabelMouseEnter",mouseLeave:"onLabelMouseLeave",click:"onLabelClick",text:{mouseEnter:"onLabelTextMouseEnter",mouseLeave:"onLabelTextMouseLeave",click:"onLabelTextClick"}},base:{click:"onBaseClick"}}},dispatcher:function(t,e,i,a,n,o){var r,l={elements:t,data:e.scData,event:a,source:i};c(l),n&&o&&c(l={elements:t,data:e.scData,event:o,source:n}),-1<a.indexOf("MouseEnter")?r="onMouseEnter":-1<a.indexOf("MouseLeave")?r="onMouseLeave":-1<a.indexOf("Click")&&(r="onClick"),r&&(l={elements:t,data:e.scData,event:r,source:n||i}),c(l)},getRegisteredCallback:function(t){return i[t]},clearRegisteredCallbacks:function(){i={}}}},_SC.prototype.getClickManager=function(){var i=this,a=null;return{click:function(t,e){i.config.disableInteractions||(a===t?(a=null,i.highlighting.resetHighlights()):(a=null,i.highlighting.resetHighlights(),e(),a=t))},isClicked:function(){return!!i.config.disableInteractions||null!==a},reset:function(){a=null}}},_SC.prototype.getInteractions=function(){var i=this;function a(t,e){i.clickManager.isClicked()||(e=e||d3.select(t).data()[0],i.highlighting.highlightRibbon(t),i.config.valueLabel.disable||i.highlighting.highlightLabel(e.scData.key,e.scData.attribute))}function n(t,e){i.clickManager.isClicked()||(e=e||d3.select(t).data()[0],i.highlighting.highlightRibbonByKey(e.scData.key),i.highlighting.highlightLabelByKey(e.scData.key))}function o(t,e){i.clickManager.isClicked()||(e=e||d3.select(t).data()[0],i.highlighting.highlightRibbonByAttribute(e.scData.attribute),i.scBackdrops.filter('path.value-label-backdrop[sc-data-attribute="'+e.scData.attribute+'"]').attr("fill-opacity",i.config.valueLabel.backdropHighlightOpacity),i.highlighting.highlightLabelByAttribute(e.scData.attribute))}return{onRibbonMouseEnter:a,onRibbonMouseLeave:function(t,e){i.highlighting.resetHighlights()},onRibbonClick:function(t,e){i.clickManager.click(t,function(){a(t,e)})},onKeyMouseEnter:n,onKeyMouseLeave:function(t,e){i.highlighting.resetHighlights()},onKeyClick:function(t,e){i.clickManager.click(t,function(){n(t,e)})},onAttributeMouseEnter:o,onAttributeMouseLeave:function(t,e){i.highlighting.resetHighlights()},onAttributeClick:function(t,e){i.clickManager.click(t,function(){o(t,e)})}}},_SC.prototype.getHighlighting=function(){var h=this,u=h.eventManager.getEventNames();function g(t,e,i,a){if(h.d3RootNode.select("g.key-group").each(function(){this.parentNode.appendChild(this)}),h.eventManager.getRegisteredCallback(a)){var n={elements:[],data:{value:[]},event:a,source:"ribbon"};t&&(n.data.key=t),e&&(n.data.attribute=e),i.each(function(t){n.elements.push(this),n.data.value.push(t.scData)}),0<n.elements.length&&h.eventManager.invokeCallback(n)}}return{highlightRibbon:function(t,e,i){if(t){if(!e){var a=h.scRibbons.filter(".highlighted");h.scRibbons.classed("highlighted",!1).attr("fill-opacity",h.config.ribbon.hoverInverseOpacity),g("","",a,u.ribbon.highlightRemoved)}var n=d3.select(t).attr("fill-opacity",h.config.ribbon.hoverOpacity).classed("highlighted",!0).classed("highlight-locked",function(){return i||d3.select(this).classed("highlight-locked")}).datum();return t.parentNode.appendChild(t),h.eventManager.dispatcher([t],n,"ribbon",u.ribbon.highlight),n}},highlightRibbonByValue:function(t,e,i,a,n){if(e||i||t){var o='[sc-data-value="'+t+'"]',r='[sc-data-attribute="'+i+'"]',l='[sc-data-key="'+e+'"]',c=h.scRibbons;if(!a){e&&(c=c.filter(":not("+l+")")),i&&(c=c.filter(":not("+r+")")),t&&(c=c.filter(":not("+o+")"));var s=(c=c.filter(":not(.highlight-locked)")).filter(".highlighted");c.classed("highlighted",!1).attr("fill-opacity",h.config.ribbon.hoverInverseOpacity),g("","",s,u.ribbon.highlightRemoved)}return c=h.scRibbons,e&&(c=c.filter(l)),i&&(c=c.filter(r)),t&&(c=c.filter(o)),c.attr("fill-opacity",h.config.ribbon.hoverOpacity).classed("highlighted",!0).classed("highlight-locked",function(){return n||d3.select(this).classed("highlight-locked")}).each(function(t){this.parentNode.appendChild(this)}),g(e,"",c,u.ribbon.highlight),c}},highlightRibbonByKey:function(t,e,i){if(t&&"string"==typeof t){var a='[sc-data-key="'+t+'"]',n=h.scRibbons.filter(a).attr("fill-opacity",h.config.ribbon.hoverOpacity).classed("highlighted",!0).classed("highlight-locked",function(){return i||d3.select(this).classed("highlight-locked")}).each(function(){this.parentNode.appendChild(this)});return g(t,"",n,u.ribbon.highlight),n=(n=h.scRibbons.filter(":not("+a+")")).filter(":not(.highlight-locked)"),e&&(n=n.filter(":not(.highlighted)")),n.size()&&(n.classed("highlighted",!1).attr("fill-opacity",h.config.ribbon.hoverInverseOpacity),g(t,"",n,u.ribbon.highlightRemoved)),n}},highlightRibbonByAttribute:function(t,e,i){if(t&&"string"==typeof t){var a='[sc-data-attribute="'+t+'"]',n=h.scRibbons.filter(a).attr("fill-opacity",h.config.ribbon.hoverOpacity).classed("highlighted",!0).classed("highlight-locked",function(){return i||d3.select(this).classed("highlight-locked")}).each(function(){this.parentNode.appendChild(this)});return g("",t,n,u.ribbon.highlight),n=(n=h.scRibbons.filter(":not("+a+")")).filter(":not(.highlight-locked)"),e&&(n=n.filter(":not(.highlighted)")),n.size()&&(n.classed("highlighted",!1).attr("fill-opacity",h.config.ribbon.hoverInverseOpacity),g(t,"",n,u.ribbon.highlightRemoved)),n}},highlightLabel:function(t,e,i,a){if("string"==typeof t&&"string"==typeof e){var n='[sc-data-attribute="'+e+'"]',o='[sc-data-key="'+t+'"]';h.scLabels.filter(n+o).classed("highlighted",!0).classed("highlight-locked",function(){return a||d3.select(this).classed("highlight-locked")}).attr("fill",function(t){return t.color}).attr("fill-opacity",h.config.valueLabel.fontHighlightOpacity).attr("font-size",h.config.valueLabel.fontSize+h.config.valueLabel.fontHighlightSizeIncrement).attr("font-weight","bold"),i||h.scLabels.filter(n+":not("+o+")").classed("highlighted",!1).attr("font-weight","normal").attr("font-size",h.config.valueLabel.fontSize).attr("fill-opacity",h.config.valueLabel.fontOpacity).attr("fill",h.config.valueLabel.fontHighlightInverseColor),h.config.valueLabel.autoHide&&h.scBackdrops.filter(n).attr("fill-opacity",h.config.valueLabel.backdropHighlightOpacity)}},highlightLabelByKey:function(t,e,i){if("string"==typeof t){var a='[sc-data-key="'+t+'"]';h.scLabels.filter(a).classed("highlighted",!0).classed("highlight-locked",function(){return i||d3.select(this).classed("highlight-locked")}).attr("fill",function(t){return t.color}).attr("fill-opacity",h.config.valueLabel.fontHighlightOpacity).attr("font-size",h.config.valueLabel.fontSize+h.config.valueLabel.fontHighlightSizeIncrement).attr("font-weight","bold"),e||h.scLabels.filter(":not("+a+")").classed("highlighted",!1).attr("font-size",h.config.valueLabel.fontSize).attr("fill-opacity",h.config.valueLabel.fontOpacity).attr("font-weight","normal").attr("fill",h.config.valueLabel.fontHighlightInverseColor),h.config.valueLabel.autoHide&&h.scBackdrops.attr("fill-opacity",h.config.valueLabel.backdropHighlightOpacity)}},highlightLabelByAttribute:function(t,e,i){if("string"==typeof t){var a='[sc-data-attribute="'+t+'"]';h.scLabels.filter(a).classed("highlighted",!0).classed("highlight-locked",function(){return i||d3.select(this).classed("highlight-locked")}).attr("fill",function(t){return t.color}).attr("fill-opacity",h.config.valueLabel.fontHighlightOpacity).attr("font-size",h.config.valueLabel.fontSize+h.config.valueLabel.fontHighlightSizeIncrement).attr("font-weight","bold"),e||h.scLabels.filter(":not("+a+")").classed("highlighted",!1).attr("font-size",h.config.valueLabel.fontSize).attr("fill-opacity",h.config.valueLabel.fontOpacity).attr("font-weight","normal").attr("fill",h.config.valueLabel.fontHighlightInverseColor),h.config.valueLabel.autoHide&&h.scBackdrops.filter(a).attr("fill-opacity",h.config.valueLabel.backdropHighlightOpacity)}},resetHighlights:function(t){if(t||!h.clickManager.isClicked()){var e=h.scRibbons;if(t)e.classed("highlighted",!1).classed("highlight-locked",!1).attr("fill-opacity",h.config.ribbon.opacity);else{var i=h.scRibbons.filter(".highlight-locked");0<i.size()?((e=h.scRibbons.filter(":not(.highlight-locked)")).classed("highlighted",!1).attr("fill-opacity",h.config.ribbon.hoverInverseOpacity),i.attr("fill-opacity",h.config.ribbon.hoverOpacity)):e.classed("highlighted",!1).attr("fill-opacity",h.config.ribbon.opacity)}g("","",e,u.ribbon.highlightRemoved);var a=h.scLabels,n=a.filter(".highlight-locked");h.scBackdrops,!t&&0<n.size()?(n.attr("font-size",h.config.valueLabel.fontSize+h.config.valueLabel.fontHighlightSizeIncrement).attr("font-weight","bold").attr("font-size",h.config.valueLabel.fontSize).attr("fill",function(t){return t.color}).attr("fill-opacity",function(){return h.config.valueLabel.autoHide?0:h.config.valueLabel.fontOpacity}),a.filter(":not(.highlight-locked)").classed("highlighted",!1).attr("font-size",h.config.valueLabel.fontSize).attr("fill",h.config.valueLabel.fontHighlightInverseColor).attr("font-weight","normal").attr("fill-opacity",function(){return h.config.valueLabel.autoHide?0:h.config.valueLabel.fontOpacity})):(h.scLabels.classed("highlighted",!1).attr("fill-opacity",function(){return h.config.valueLabel.autoHide?0:h.config.valueLabel.fontOpacity}).attr("font-size",h.config.valueLabel.fontSize).attr("fill",function(t){return t.color}).attr("font-weight","normal"),h.scBackdrops.classed("highlighted",!1).attr("fill-opacity",function(){return h.config.valueLabel.autoHide?0:h.config.valueLabel.backdropOpacity}))}},clearLocks:function(){h.scRibbons.classed("highlight-locked",!1),h.scBackdrops.classed("highlight-locked",!1),h.scLabels.classed("highlight-locked",!1)}}},_SC.prototype.getExport=function(){var l=this;return{config:function(t){return t&&(l.config=t,l.validateConfig(),l.update()),l.config},update:function(t){l.data=t.data||l.data,l.dataAttributes=t.dataAttributes||l.dataAttributes,l.dataKey=t.datakey||l.dataKey,l.update()},redraw:function(){l.redraw()},delete:function(){l.d3RootNode.remove(),l.d3RootNode=d3.select(l.parentElement)},elements:{getSVGElement:function(){return l.d3RootNode.node()},getAttributeColor:function(t){if(t)return l.cc.colorScale(t)}},events:{registerCallback:function(t,e){return l.eventManager.registerCallback(t,e)},getEventNames:function(){return l.eventManager.getEventNames()},getRegisteredCallback:function(t){return"string"==typeof t?l.eventManager.getRegisteredCallback(t):null},clearRegisteredCallbacks:function(){l.eventManager.clearRegisteredCallbacks()}},interactions:{enable:function(t){t=void 0===t||t,l.config.disableInteractions=!t},highlightRibbonByElement:function(t,e,i,a){if(l.highlighting.highlightRibbon(t,e,i),!a){var n=d3.select(t).data()[0];l.highlighting.highlightLabel(n.scData.key,n.scData.attribute,i)}},highlightRibbonByValue:function(t,e,i,a,n,o){var r=l.highlighting.highlightRibbonByValue(t,e,i,a,n);o||r.each(function(t){l.highlighting.highlightLabel(t.scData.key,t.scData.attribute,n)})},highlightRibbonByKey:function(t,e,i,a){l.highlighting.highlightRibbonByKey(t,e,i);a||l.highlighting.highlightLabelByKey(t,e,i)},highlightRibbonByAttribute:function(t,e,i,a){l.highlighting.highlightRibbonByAttribute(t,e,i),a||l.highlighting.highlightLabelByAttribute(t,e,i)},resetHighlights:function(t){l.clickManager.reset(),l.highlighting.resetHighlights(t)},clearLocks:function(){l.highlighting.clearLocks()}}}};