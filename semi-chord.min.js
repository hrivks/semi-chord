/*! semi-chord - v1.0.0 | 2017-08-28
 * Hari Vikas Janarthanan | MIT License | https://github.com/hrivks/semi-chord#readme */
function semiChord(t,e,i,a,n){if(!d3)throw"semi-chord: D3.js required. Please visit https://d3js.org/";return new _SC(t,e,i,a,n).getExport()}var _SC=function(t,e,i,a,n){if(!t)throw"semi-chord: invalid parent element selector. Please specify a element selector string or HTMLElement or SVGElement";return this.parentElement=t,this.data=e,this.config=i,this.dataAttributes=a,this.dataKey=n,this.d3RootNode=d3.select(this.parentElement),!!this.validateData()&&(!!this.validateConfig()&&(this.utils=new this.Utils(this.config.radius,this.config.centerX,this.config.centerY),this.cc=this.computeCoordinates(),this.d3RootNode=this.d3RootNode.append("svg").classed("semi-chord",!0),this.clickManager=this.getClickManager(),this.eventManager=this.getEventManager(),this.highlighting=this.getHighlighting(),this.interactions=this.getInteractions(),void this.draw()))};_SC.prototype.update=function(){this.validateConfig(),this.cc=this.computeCoordinates(),this.redraw()},_SC.prototype.redraw=function(){this.d3RootNode.selectAll("*").remove(),this.draw(),this.clickManager.reset()},_SC.prototype.validateConfig=function(){var t=this.config,e={width:600,height:400,radius:133,centerX:240,centerY:200,disableInteractions:!1,colorScheme:d3.schemeCategory10,fontFamily:"sans-serif",outlineCircle:{stroke:"#EEE",fill:"none",strokeWidth:"0.25"},ribbon:{opacity:.5,hoverOpacity:.7,hoverInverseOpacity:.1},arc:{innerPadding:.02,outerPadding:.2,rangeStart:0,rangeEnd:.5,width:15,titleTextOffset:15},key:{radius:10,color:"#AAA",fontColor:"#AAA",fontSize:14,rangeStart:.65,rangeEnd:.85},valueLabel:{offsetX:30,backdropOffsetX:12,backdropOffsetXRight:1,fontSize:11,verticalSpace:12,fontOpacity:.8,fontHighlightOpacity:1,fontHighlightInverseColor:"#AAA",fontHighlightSizeIncrement:0,backdropOpacity:.2,backdropHighlightOpacity:.3,disable:!1,autoHide:!1}},i=this.d3RootNode.node();if(!i)return console.log("semi-chord: no valid element found for given parent element selector"),!1;if(t){var a,n;i instanceof SVGElement?(a=i.width.baseVal.value,n=i.height.baseVal.value):(a=i.clientWidth,n=i.clientHeight),a=a||e.width,n=n||e.height;s=Math.round(Math.min(a,n)/3);if(t.radius=t.radius||s,t.centerX=t.centerX||a/2.5,t.centerY=t.centerY||n/2,t.disableInteractions=t.disableInteractions||e.disableInteractions,t.colorScheme=t.colorScheme||e.colorScheme,t.fontFamily=t.fontFamily||e.fontFamily,t.outlineCircle){var r=t.outlineCircle,o=e.outlineCircle;r.stroke=r.stroke||o.stroke,r.fill=r.fill||o.fill,r.strokeWidth=r.strokeWidth||o.strokeWidth}else t.outlineCircle=e.outlineCircle;if(t.ribbon){var r=t.ribbon,o=e.ribbon;r.opacity=r.opacity||o.opacity,r.hoverOpacity=r.hoverOpacity||o.hoverOpacity,r.hoverInverseOpacity=r.hoverInverseOpacity||o.hoverInverseOpacity}else t.ribbon=e.ribbon;if(t.arc){var r=t.arc,o=e.arc;r.innerPadding=r.innerPadding||o.innerPadding,r.outerPadding=r.outerPadding||o.outerPadding,r.rangeStart=r.rangeStart||o.rangeStart,r.rangeEnd=r.rangeEnd||o.rangeEnd,r.width=r.width||o.width,r.titleTextOffset=r.titleTextOffset||o.titleTextOffset}else t.arc=e.arc;if(t.key){var r=t.key,o=e.key;r.radius=r.radius||.05*t.radius,r.color=r.color||o.color,r.rangeStart=r.rangeStart||o.rangeStart,r.rangeEnd=r.rangeEnd||o.rangeEnd,r.fontColor=r.fontColor||o.fontColor,r.fontSize=r.fontSize||o.fontSize}else t.key=e.key,t.key.radius=.05*t.radius;if(t.valueLabel){var r=t.valueLabel,o=e.valueLabel;r.offsetX=r.offsetX||o.offsetX,r.backdropOffsetX=r.backdropOffsetX||o.backdropOffsetX,r.backdropOffsetXRight=r.backdropOffsetXRight||o.backdropOffsetXRight,r.fontSize=r.fontSize||o.fontSize,r.verticalSpace=r.verticalSpace||o.verticalSpace,r.fontOpacity=r.fontOpacity||o.fontOpacity,r.fontHighlightOpacity=r.fontHighlightOpacity||o.fontHighlightOpacity,r.fontHighlightInverseColor=r.fontHighlightInverseColor||o.fontHighlightInverseColor,r.fontHighlightSizeIncrement=r.fontHighlightSizeIncrement||o.fontHighlightSizeIncrement,r.backdropOpacity=r.backdropOpacity||o.backdropOpacity,r.backdropHighlightOpacity=r.backdropHighlightOpacity||o.backdropHighlightOpacity,r.disable=r.disable||o.disable,r.autoHide=r.autoHide||o.autoHide}else t.valueLabel=e.valueLabel}else{this.config=e,t=this.config;var l=i.clientWidth||e.width,c=i.clientHeight||e.height,s=Math.round(Math.min(l,c)/3);t.radius=s,t.centerX=l/2.5,t.centerY=c/2,t.key.radius=.05*t.radius}return!0},_SC.prototype.validateData=function(){if(!this.data||!this.data[0])return console.log("semi-chord: Invalid data. Expected: array of JSON objects"),!1;if(0===this.data.length)return console.log("semi-chord: No data to plot"),!1;if(!this.dataAttributes){this.dataAttributes=[];for(var t in this.data[0])this.data[0].hasOwnProperty(t)&&this.dataKey!==t&&this.dataAttributes.push(t)}return this.dataKey=this.dataKey||this.dataAttributes.splice(0,1)[0],"string"!=typeof this.dataKey?(console.log("semi-chord: Invalid data key"),!1):this.dataAttributes instanceof Array?0!==this.dataAttributes.length||(console.log("semi-chord: No data-attributes found."),!1):(console.log("semi-chord: Invalid data-attributes. Expected: array of string"),!1)},_SC.prototype.Utils=function(t,e,i){this.getCoordinateOnCirlce=function(a,n){return n=n||t,{x:Math.round(e+n*Math.sin(a)),y:Math.round(i-n*Math.cos(a))}},this.getXCoordinateOnCircle=function(i,a){return a=a||t,Math.round(e+a*Math.sin(i))},this.getYCoordinateOnCircle=function(e,a){return a=a||t,Math.round(i-a*Math.cos(e))},this.getRibbonBetweenPoints=function(t,e,i,a){var n=[];n=n.concat(["M ",t.x,",",t.y]);var r={x:(t.x+e.x)/2,y:t.y-10};return n=n.concat([" Q ",r.x,",",r.y," ",e.x,","+e.y]),n=n.concat([" Q ",a.x,",",a.y," ",i.x,","+i.y]),r={x:(t.x+i.x)/2,y:t.y+5},(n=n.concat([" Q ",r.x,",",r.y," ",t.x,",",t.y])).join("")},this.getValueLabelBackdrop=function(t,e,i,a){var n={x:e.x+a,y:e.y-10},r={x:i.x+a,y:i.y+10},o=[];return o=o.concat(["M ",n.x,",",n.y]),o=o.concat([" Q ",(e.x+n.x)/2,",",e.y," ",e.x,",",e.y]),o=o.concat([" Q ",(t.x+e.x)/2,",",t.y," ",t.x,",",t.y]),o=o.concat([" Q ",(i.x+t.x)/2,",",t.y," ",i.x,",",i.y]),o=o.concat([" Q ",(r.x+i.x)/2,",",i.y," ",r.x,",",r.y]),(o=o.concat([" Q ",r.x+(r.y-n.y)/2,",",(r.y+n.y)/2," ",n.x,",",n.y])).join("")},this.getNumericValue=function(t){if(isFinite(t))return t;var e=t.replace(/[^0-9.]/g,"");return e?parseFloat(e):0}},_SC.prototype.computeCoordinates=function(){var t=this,e=2*Math.PI,i=d3.scalePoint().domain(t.data.map(function(t,e){return e})).range([e*t.config.key.rangeStart,e*t.config.key.rangeEnd]),a=d3.scaleBand().domain(t.dataAttributes).range([e*t.config.arc.rangeStart,e*t.config.arc.rangeEnd]).paddingInner(t.config.arc.innerPadding).paddingOuter(t.config.arc.outerPadding),n=d3.scaleOrdinal(t.config.colorScheme),r=a.bandwidth()-t.config.arc.innerPadding,o=t.data.map(function(e,a){var n=t.utils.getCoordinateOnCirlce(i(t.data.length-1-a));return n.text=e[t.dataKey],n}),l=t.dataAttributes.map(function(t){var e=a(t);return{start:e,end:e+r}}),c=function(){var e=[];return t.dataAttributes.forEach(function(i,a){var c=t.data.reduce(function(e,a){return e+t.utils.getNumericValue(a[i])},0),s=0===c?0:r/c,u=l[a].start;t.data.forEach(function(r,l){var c=t.utils.getNumericValue(r[i]),h=u+c*s;e.push({source:o[l],start:t.utils.getCoordinateOnCirlce(u),end:t.utils.getCoordinateOnCirlce(h),mid:t.utils.getCoordinateOnCirlce((u+h)/2),color:n(i),text:r[t.dataKey]+" : "+r[i],scData:{key:r[t.dataKey],attribute:t.dataAttributes[a],value:r[i]}}),u=h})}),e}();return{colorScale:n,keyPointCoordinates:o,arcAngles:l,ribbonPositions:c}},_SC.prototype.draw=function(){var t=this,e=this.config,i=this.d3RootNode,a=this.cc,n=this.interactions,r=this.utils,o=this.eventManager,l=this.eventManager.getEventNames();i.append("circle").attr("cx",e.centerX).attr("cy",e.centerY).attr("r",e.radius).attr("stroke",e.outlineCircle.stroke).attr("stroke-width",e.outlineCircle.strokeWidth).attr("fill",e.outlineCircle.fill),i.append("g").classed("ribbon-wrap",!0).selectAll("path.ribbon").data(a.ribbonPositions).enter().append("path").classed("ribbon",!0).attr("d",function(e){return t.utils.getRibbonBetweenPoints(e.source,e.start,e.end,e.mid)}).attr("fill",function(t){return t.color}).attr("fill-opacity",e.ribbon.opacity).attr("sc-data-key",function(t){return t.scData.key}).attr("sc-data-attribute",function(t){return t.scData.attribute}).attr("sc-data-value",function(t){return t.scData.value}).on("mouseenter",function(t){n.onRibbonMouseEnter(this,t),o.dispatcher([this],t,"ribbon",l.ribbon.mouseEnter)}).on("mouseleave",function(t){n.onRibbonMouseLeave(this,t),o.dispatcher([this],t,"ribbon",l.ribbon.mouseLeave)}).on("click",function(t){n.onRibbonClick(this,t),o.dispatcher([this],t,"ribbon",l.ribbon.click)});var c=i.selectAll("g.key-group").data([a.keyPointCoordinates]).enter().append("g").classed("key-group",!0).selectAll("g.key-element").data(function(t){return t}).enter().append("g").classed("key-element",!0).selectAll("circle.key").data(function(e,i){return e.scData={key:t.data[i][t.dataKey],value:t.dataAttributes.map(function(e){return{attribute:e,value:t.data[i][e]}})},[e]}).enter();c.append("circle").classed("key",!0).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).attr("r",e.key.radius).attr("fill",e.key.color).on("mouseenter",function(t){n.onKeyMouseEnter(this,t),o.dispatcher([this],t,"key",l.key.mouseEnter,"key.point",l.key.point.mouseEnter)}).on("mouseleave",function(t){n.onKeyMouseLeave(this,t),o.dispatcher([this],t,"key",l.key.mouseLeave,"key.point",l.key.point.mouseLeave)}).on("click",function(t){n.onKeyClick(this,t),o.dispatcher([this],t,"key",l.key.click,"key.point",l.key.point.click)}),c.append("text").text(function(t){return t.text}).style("cursor","pointer").attr("x",function(t){return t.x-.08*e.radius}).attr("y",function(t){return t.y+.025*e.radius}).attr("text-anchor","end").attr("fill",e.key.fontColor).attr("font-size",e.key.fontSize).on("mouseenter",function(t){n.onKeyMouseEnter(this,t),o.dispatcher([this],t,"key",l.key.mouseEnter,"key.text",l.key.text.mouseEnter)}).on("mouseleave",function(t){n.onKeyMouseLeave(this,t),o.dispatcher([this],t,"key",l.key.mouseLeave,"key.text",l.key.text.mouseLeave)}).on("click",function(t){n.onKeyMouseLeave(this,t),o.dispatcher([this],t,"key",l.key.click,"key.text",l.key.text.click)});var s=i.append("g").attr("transform","translate("+e.centerX+", "+e.centerY+")").classed("attr-group",!0);s.selectAll("path.attribute").data(t.dataAttributes.map(function(e){return{scData:{attribute:e,value:t.data.map(function(i){return{key:i[t.dataKey],value:i[e]}})}}})).enter().append("path").classed("attribute",!0).attr("d",function(t,i){var n=a.arcAngles[i];return d3.arc().innerRadius(e.radius-.25*e.arc.width).outerRadius(e.radius+.75*e.arc.width).startAngle(n.start).endAngle(n.end)()}).attr("fill",function(t){return a.colorScale(t.scData.attribute)}).on("mouseenter",function(t){n.onAttributeMouseEnter(this,t),o.dispatcher([this],t,"attribute",l.attribute.mouseEnter,"attribute.arc",l.attribute.arc.mouseEnter)}).on("mouseleave",function(t){n.onAttributeMouseLeave(this,t),o.dispatcher([this],t,"attribute",l.attribute.mouseLeave,"attribute.arc",l.attribute.arc.mouseLeave)}).on("click",function(t){n.onAttributeClick(this,t),o.dispatcher([this],t,"attribute",l.attribute.click,"attribute.arc",l.attribute.arc.click)});var u=s.append("g").classed("attribute-texts",!0).attr("transform","translate(-"+e.centerX+", -"+e.centerY+")"),h=u.selectAll("text.attribute-title").data(t.dataAttributes.map(function(i,n){var o=(a.arcAngles[n].start+a.arcAngles[n].end)/2,l=e.radius+e.arc.width+e.arc.titleTextOffset,c=r.getCoordinateOnCirlce(o,l),s=a.colorScale(i);return{x:c.x,y:c.y,color:s,scData:{attribute:i,value:t.data.map(function(e){return{key:e[t.dataKey],value:e[i]}})}}})).enter().append("text").classed("attribute-title",!0).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("fill",function(t){return t.color}).text(function(t){return t.scData.attribute}).style("cursor","pointer").attr("alignment-baseline","central").attr("font-size",e.key.fontSize).on("mouseenter",function(t){n.onAttributeMouseEnter(this,t),o.dispatcher([this],t,"attribute",l.attribute.mouseEnter,"attribute.text",l.attribute.text.mouseEnter)}).on("mouseleave",function(t){n.onAttributeMouseLeave(this,t),o.dispatcher([this],t,"attribute",l.attribute.mouseLeave,"attribute.text",l.attribute.text.mouseLeave)}).on("click",function(t){n.onAttributeClick(this,t),o.dispatcher([this],t,"attribute",l.attribute.click,"attribute.text",l.attribute.text.click)});if(!e.valueLabel.disable){var g=u.selectAll("g.value-labels").data([t.dataAttributes]).enter().append("g").classed("value-labels",!0).attr("fill-opacity",function(){return e.valueLabel.autoHide||e.valueLabel.disable?0:1}),d=[];g.selectAll("text.attribute-value-label").data(t.dataAttributes.map(function(i,n){var r=t.data.map(function(e){return e[t.dataKey]+" : "+(e[i]||0)}),o=h.nodes()[n].getBBox(),l=o.x+o.width+e.valueLabel.offsetX,c=o.y+o.height/2;return{attribute:i,color:a.colorScale(i),values:r,x:l,y:c,height:e.valueLabel.verticalSpace}})).enter().append("text").classed("value-label",!0).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("sc-data-attribute",function(t){return t.attribute}).selectAll("tspan.value-label-element").data(function(i,a){var n=i.values.length*i.height/2,r=d3.scaleLinear().range([-n,n]).domain([0,i.values.length-1]),o=e.valueLabel.offsetX-e.valueLabel.backdropOffsetX;d.push({center:{x:i.x-o,y:i.y},top:{x:i.x+e.valueLabel.backdropOffsetXRight+Math.abs(r(0))/2,y:i.y+r(0)-15},bottom:{x:i.x+e.valueLabel.backdropOffsetXRight+Math.abs(r(i.values.length-1))/2,y:i.y+r(i.values.length-1)+15}});var l=i.color;return i.values.map(function(e,a){return{x:i.x+5+Math.abs(r(a))/2,y:i.y+r(a),text:e,color:l,scData:{key:t.data[a][t.dataKey],attribute:i.attribute,value:t.data[a][i.attribute]}}})}).enter().append("tspan").classed("value-label-element",!0).attr("sc-data-key",function(t){return t.scData.key}).attr("sc-data-attribute",function(t){return t.scData.attribute}).attr("sc-data-value",function(t){return t.scData.value}).text(function(t){return t.text}).style("cursor","pointer").attr("alignment-baseline","central").attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("font-size",e.valueLabel.fontSize).attr("font-weight","normal").attr("fill",function(t){return t.color}).attr("fill-opacity",function(){return e.valueLabel.autoHide||e.valueLabel.disable?0:e.valueLabel.fontOpacity}).on("mouseenter",function(i){if(!e.valueLabel.autoHide&&!e.valueLabel.disable){var a=t.scRibbons.filter('path.ribbon[sc-data-key="'+i.scData.key+'"][sc-data-attribute="'+i.scData.attribute+'"]').node();n.onRibbonMouseEnter(a,i),o.dispatcher([this],i,"label.text",l.label.text.mouseEnter)}}).on("mouseleave",function(t){n.onRibbonMouseLeave(this,t),o.dispatcher([this],t,"label.text",l.label.text.mouseLeave)}).on("click",function(i){if(!e.valueLabel.autoHide&&!e.valueLabel.disable){var a=t.scRibbons.filter('path.ribbon[sc-data-key="'+i.scData.key+'"][sc-data-attribute="'+i.scData.attribute+'"]').node();n.onRibbonClick(a,i),o.dispatcher([this],i,"label.text",l.label.text.click)}}),g.selectAll("path.value-label-backdrop").data(d.map(function(e,n){return e.color=a.colorScale(t.dataAttributes[n]),e.width=i.selectAll("text.value-label").nodes()[n].getBBox().width,e.scData={attribute:t.dataAttributes[n],value:t.data.map(function(e){return{key:e[t.dataKey],value:e[t.dataAttributes[n]]}})},e})).enter().insert("path",":first-child").classed("value-label-backdrop",!0).attr("sc-data-attribute",function(t){return t.scData.attribute}).attr("d",function(t){return r.getValueLabelBackdrop(t.center,t.top,t.bottom,t.width)}).attr("fill-opacity",function(){return e.valueLabel.autoHide||e.valueLabel.disable?0:e.valueLabel.backdropOpacity}).attr("fill",function(t){return t.color}).on("mouseenter",function(t){e.valueLabel.autoHide||e.valueLabel.disable||(n.onAttributeMouseEnter(this,t),o.dispatcher([this],t,"label",l.label.mouseEnter))}).on("mouseleave",function(t){n.onAttributeMouseLeave(this,t),o.dispatcher([this],t,"label",l.label.mouseLeave)}).on("click",function(t){e.valueLabel.autoHide||e.valueLabel.disable||(n.onAttributeClick(this,t),o.dispatcher([this],t,"label",l.label.click))})}var b=i.node().getBBox();i.insert("rect",":first-child").classed("base",!0).attr("x",b.x).attr("y",b.y).attr("width",b.width).attr("height",b.height).attr("fill-opacity",0).on("click",function(){t.clickManager.reset(),t.highlighting.resetHighlights(),o.dispatcher([this],{},"base","onBaseClick")}),i.attr("width","100%").attr("height","100%").attr("font-family",t.config.fontFamily),t.scRibbons=i.selectAll("path.ribbon"),t.scLabels=i.selectAll("tspan.value-label-element"),t.scBackdrops=i.selectAll("path.value-label-backdrop")},_SC.prototype.getEventManager=function(){function t(t){var i=t&&t.event;if(i&&e[i])try{setTimeout(function(){e[i](t)},0)}catch(e){console.log("Exception in callback for event :"+t.event),console.log(e)}}var e={};return{registerCallback:function(t,i){return"string"==typeof t&&"function"==typeof i&&(e[t]=i,!0)},invokeCallback:t,getEventNames:function(){return{onClick:"onClick",onMouseEnter:"onMouseEnter",onMouseLeave:"onMouseLeave",ribbon:{mouseEnter:"onRibbonMouseEnter",mouseLeave:"onRibbonMouseLeave",click:"onRibbonClick",highlight:"onRibbonHighlight",highlightRemoved:"onRibbonHighlightRemoved"},key:{mouseEnter:"onKeyMouseEnter",mouseLeave:"onKeyMouseLeave",click:"onKeyClick",point:{mouseEnter:"onKeyPointMouseEnter",mouseLeave:"onKeyPointMouseLeave",click:"onKeyPointClick"},text:{mouseEnter:"onKeyTextMouseEnter",mouseLeave:"onKeyTextMouseLeave",click:"onKeyTextClick"}},attribute:{mouseEnter:"onAttributeMouseEnter",mouseLeave:"onAttributeMouseLeave",click:"onAttributeClick",arc:{mouseEnter:"onAttributeArcMouseEnter",mouseLeave:"onAttributeArcMouseLeave",click:"onAttributeArcClick"},text:{mouseEnter:"onAttributeTextMouseEnter",mouseLeave:"onAttributeTextMouseLeave",click:"onAttributeTextClick"}},label:{mouseEnter:"onLabelMouseEnter",mouseLeave:"onLabelMouseLeave",click:"onLabelClick",text:{mouseEnter:"onLabelTextMouseEnter",mouseLeave:"onLabelTextMouseLeave",click:"onLabelTextClick"}},base:{click:"onBaseClick"}}},dispatcher:function(e,i,a,n,r,o){var l={elements:e,data:i.scData,event:n,source:a};t(l),r&&o&&t(l={elements:e,data:i.scData,event:o,source:r});var c;n.indexOf("MouseEnter")>-1?c="onMouseEnter":n.indexOf("MouseLeave")>-1?c="onMouseLeave":n.indexOf("Click")>-1&&(c="onClick"),c&&(l={elements:e,data:i.scData,event:c,source:r||a}),t(l)},getRegisteredCallback:function(t){return e[t]},clearRegisteredCallbacks:function(){e={}}}},_SC.prototype.getClickManager=function(){var t=this,e=null;return{click:function(i,a){t.config.disableInteractions||(e===i?(e=null,t.highlighting.resetHighlights()):(e=null,t.highlighting.resetHighlights(),a(),e=i))},isClicked:function(){return!!t.config.disableInteractions||null!==e},reset:function(){e=null}}},_SC.prototype.getInteractions=function(){function t(t,e){a.clickManager.isClicked()||(e=e||d3.select(t).data()[0],a.highlighting.highlightRibbon(t),a.config.valueLabel.disable||a.highlighting.highlightLabel(e.scData.key,e.scData.attribute))}function e(t,e){a.clickManager.isClicked()||(e=e||d3.select(t).data()[0],a.highlighting.highlightRibbonByKey(e.scData.key),a.highlighting.highlightLabelByKey(e.scData.key))}function i(t,e){a.clickManager.isClicked()||(e=e||d3.select(t).data()[0],a.highlighting.highlightRibbonByAttribute(e.scData.attribute),a.scBackdrops.filter('path.value-label-backdrop[sc-data-attribute="'+e.scData.attribute+'"]').attr("fill-opacity",a.config.valueLabel.backdropHighlightOpacity),a.highlighting.highlightLabelByAttribute(e.scData.attribute))}var a=this;return{onRibbonMouseEnter:t,onRibbonMouseLeave:function(t,e){a.highlighting.resetHighlights()},onRibbonClick:function(e,i){a.clickManager.click(e,function(){t(e,i)})},onKeyMouseEnter:e,onKeyMouseLeave:function(t,e){a.highlighting.resetHighlights()},onKeyClick:function(t,i){a.clickManager.click(t,function(){e(t,i)})},onAttributeMouseEnter:i,onAttributeMouseLeave:function(t,e){a.highlighting.resetHighlights()},onAttributeClick:function(t,e){a.clickManager.click(t,function(){i(t,e)})}}},_SC.prototype.getHighlighting=function(){function t(t,i,a,n){if(e.eventManager.getRegisteredCallback(n)){var r={elements:[],data:{value:[]},event:n,source:"ribbon"};t&&(r.data.key=t),i&&(r.data.attribute=i),a.each(function(t){r.elements.push(this),r.data.value.push(t.scData)}),r.elements.length>0&&e.eventManager.invokeCallback(r)}}var e=this,i=e.eventManager.getEventNames();return{highlightRibbon:function(a,n,r){if(a){if(!n){var o=e.scRibbons.filter(".highlighted");e.scRibbons.classed("highlighted",!1).attr("fill-opacity",e.config.ribbon.hoverInverseOpacity),t("","",o,i.ribbon.highlightRemoved)}var l=d3.select(a).attr("fill-opacity",e.config.ribbon.hoverOpacity).classed("highlighted",!0).classed("highlight-locked",r).datum();a.parentNode.appendChild(a),e.eventManager.dispatcher([a],l,"ribbon",i.ribbon.highlight)}},highlightRibbonByValue:function(a,n,r,o,l){if(n||r||a){var c='[sc-data-value="'+a+'"]',s='[sc-data-attribute="'+r+'"]',u='[sc-data-key="'+n+'"]',h=e.scRibbons;if(!o){n&&(h=h.filter(":not("+u+")")),r&&(h=h.filter(":not("+s+")")),a&&(h=h.filter(":not("+c+")"));var g=h.filter(".highlighted");h.classed("highlighted",!1).attr("fill-opacity",e.config.ribbon.hoverInverseOpacity),t("","",g,i.ribbon.highlightRemoved)}return h=e.scRibbons,n&&(h=h.filter(u)),r&&(h=h.filter(s)),a&&(h=h.filter(c)),h.attr("fill-opacity",e.config.ribbon.hoverOpacity).classed("highlighted",!0).classed("highlight-locked",l).each(function(t){this.parentNode.appendChild(this)}),t(n,"",h,i.ribbon.highlight),h}},highlightRibbonByKey:function(a,n,r){if(a&&"string"==typeof a){var o='[sc-data-key="'+a+'"]',l=e.scRibbons.filter(o).attr("fill-opacity",e.config.ribbon.hoverOpacity).classed("highlighted",!0).classed("highlight-locked",r).each(function(){this.parentNode.appendChild(this)});t(a,"",l,i.ribbon.highlight),l=e.scRibbons.filter(":not("+o+")"),n&&(l=l.filter(":not(.highlighted)")),l.size()&&(l.classed("highlighted",!1).attr("fill-opacity",e.config.ribbon.hoverInverseOpacity),t(a,"",l,i.ribbon.highlightRemoved))}},highlightRibbonByAttribute:function(a,n,r){if(a&&"string"==typeof a){var o='[sc-data-attribute="'+a+'"]',l=e.scRibbons.filter(o).attr("fill-opacity",e.config.ribbon.hoverOpacity).classed("highlighted",!0).classed("highlight-locked",r).each(function(){this.parentNode.appendChild(this)});t("",a,l,i.ribbon.highlight),l=e.scRibbons.filter(":not("+o+")"),n&&(l=l.filter(":not(.highlighted)")),l.size()&&(l.classed("highlighted",!1).attr("fill-opacity",e.config.ribbon.hoverInverseOpacity),t(a,"",l,i.ribbon.highlightRemoved))}},highlightLabel:function(t,i,a){if("string"==typeof t&&"string"==typeof i){var n='[sc-data-attribute="'+i+'"]',r='[sc-data-key="'+t+'"]';e.scLabels.filter(n+r).classed("highlighted",!0).attr("fill-opacity",e.config.valueLabel.fontHighlightOpacity).attr("font-size",e.config.valueLabel.fontSize+e.config.valueLabel.fontHighlightSizeIncrement).attr("font-weight","bold"),a||e.scLabels.filter(n+":not("+r+")").classed("highlighted",!1).attr("font-weight","normal").attr("font-size",e.config.valueLabel.fontSize).attr("fill-opacity",e.config.valueLabel.fontOpacity).attr("fill",e.config.valueLabel.fontHighlightInverseColor),e.config.valueLabel.autoHide&&e.scBackdrops.filter(n).attr("fill-opacity",e.config.valueLabel.backdropHighlightOpacity)}},highlightLabelByKey:function(t,i){if("string"==typeof t){var a='[sc-data-key="'+t+'"]';e.scLabels.filter(a).classed("highlighted",!0).attr("fill-opacity",e.config.valueLabel.fontHighlightOpacity).attr("font-size",e.config.valueLabel.fontSize+e.config.valueLabel.fontHighlightSizeIncrement).attr("font-weight","bold"),i||e.scLabels.filter(":not("+a+")").classed("highlighted",!1).attr("font-size",e.config.valueLabel.fontSize).attr("fill-opacity",e.config.valueLabel.fontOpacity).attr("font-weight","normal").attr("fill",e.config.valueLabel.fontHighlightInverseColor),e.config.valueLabel.autoHide&&e.scBackdrops.attr("fill-opacity",e.config.valueLabel.backdropHighlightOpacity)}},highlightLabelByAttribute:function(t,i){if("string"==typeof t){var a='[sc-data-attribute="'+t+'"]';e.scLabels.filter(a).classed("highlighted",!0).attr("fill-opacity",e.config.valueLabel.fontHighlightOpacity).attr("font-weight","bold"),i||e.scLabels.filter(":not("+a+")").classed("highlighted",!1).attr("font-size",e.config.valueLabel.fontSize).attr("fill-opacity",e.config.valueLabel.fontOpacity).attr("font-weight","normal").attr("fill",e.config.valueLabel.fontHighlightInverseColor),e.config.valueLabel.autoHide&&e.scBackdrops.filter(a).attr("fill-opacity",e.config.valueLabel.backdropHighlightOpacity)}},resetHighlights:function(a){if(!e.clickManager.isClicked()){var n=e.scRibbons.filter(".highlighted");a&&(n=e.scRibbons.filter(":not(.highlight-locked)")),n.classed("highlighted",!1).classed("highlight-locked",!1).attr("fill-opacity",e.config.ribbon.opacity),t("","",n,i.ribbon.highlightRemoved),e.scLabels.classed("highlighted",!1).attr("fill-opacity",function(){return e.config.valueLabel.autoHide?0:e.config.valueLabel.fontOpacity}).attr("font-size",e.config.valueLabel.fontSize).attr("fill",function(t){return t.color}).attr("font-weight","normal"),e.scBackdrops.classed("highlighted",!1).attr("fill-opacity",function(){return e.config.valueLabel.autoHide?0:e.config.valueLabel.backdropOpacity})}}}},_SC.prototype.getExport=function(){var t=this;return{config:function(e){return e&&(t.config=e,t.validateConfig(),t.update()),t.config},update:function(e,i,a){t.data=e||t.data,t.dataAttributes=i||t.dataAttributes,t.dataKey=a||t.dataKey,t.update()},redraw:function(){t.redraw()},delete:function(){t.d3RootNode.remove(),t.d3RootNode=d3.select(t.parentElement)},elements:{getSVGElement:function(){return t.d3RootNode.node()},getAttributeColor:function(e){if(e)return t.cc.colorScale(e)}},events:{registerCallback:function(e,i){return t.eventManager.registerCallback(e,i)},getEventNames:function(){return t.eventManager.getEventNames()},getRegisteredCallback:function(e){return"string"==typeof e?t.eventManager.getRegisteredCallback(e):null},clearRegisteredCallbacks:function(){t.eventManager.clearRegisteredCallbacks()}},interactions:{enable:function(e){e=void 0===e||e,t.config.disableInteractions=!e},highlightRibbonByElement:function(e,i,a,n){if(t.highlighting.highlightRibbon(e,i,a),!n){var r=d3.select(e).data()[0];t.highlighting.highlightLabel(r.scData.key,r.scData.attribute,a)}},highlightRibbonByValue:function(e,i,a,n,r,o){var l=t.highlighting.highlightRibbonByValue(e,i,a,n,r);o||l.each(function(e){t.highlighting.highlightLabel(e.scData.key,e.scData.attribute,r)})},highlightRibbonByKey:function(e,i,a,n){t.highlighting.highlightRibbonByKey(e,i,a),n||t.highlighting.highlightLabelByKey(e,i,a)},highlightRibbonByAttribute:function(e,i,a,n){t.highlighting.highlightRibbonByAttribute(e,i,a),n||t.highlighting.highlightLabelByAttribute(e,i,a)},resetHighlights:function(){t.clickManager.reset(),t.highlighting.resetHighlights()}}}};